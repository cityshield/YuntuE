# 托盘图标测试指南

## 🎨 已创建的图标

我已经为你创建了 3 组托盘图标，每组都有不同的颜色，代表不同的状态：

### 图标文件列表

位置: `public/icons/`

1. **正常状态** (蓝色)
   - `tray-icon.png` (256x256)
   - `tray-icon@2x.png` (32x32)

2. **上传中状态** (绿色)
   - `tray-icon-uploading.png` (256x256)
   - `tray-icon-uploading@2x.png` (32x32)

3. **通知状态** (黄色)
   - `tray-icon-notification.png` (256x256)
   - `tray-icon-notification@2x.png` (32x32)

### 图标设计

- **形状**: 圆角正方形
- **样式**: 纯色填充 + 白色边框 + 内部半透明正方形装饰
- **尺寸**: 32x32 (@2x 用于高分辨率显示, 256x256 用于预览)

### 颜色方案

- **蓝色** (#4285F4) - 正常状态
- **绿色** (#34A853) - 上传进行中
- **黄色** (#FBBC04) - 有新通知

---

## 🧪 测试步骤

### 1. 启动应用

```bash
cd /Users/pretty/Documents/Workspace/YuntuE
npm run dev
```

或者使用 electron:dev 命令:

```bash
npm run electron:dev
```

### 2. 验证托盘图标显示

启动后，你应该能在系统托盘中看到一个**蓝色的圆角正方形图标**。

**macOS 位置**:
- 菜单栏右上角（时钟附近）

**Windows 位置**:
- 任务栏右下角系统托盘区域

### 3. 测试托盘菜单

**右键点击托盘图标**，应该显示菜单:
- ✅ 显示主窗口
- ✅ 暂停所有上传/下载
- ✅ --- (分隔线)
- ✅ 设置
- ✅ --- (分隔线)
- ✅ 退出程序

### 4. 测试双击恢复

1. 关闭主窗口 (会最小化到托盘，而不是退出)
2. **双击托盘图标**
3. 验证主窗口是否恢复显示

### 5. 测试图标状态变化

托盘图标会根据应用状态自动变化:

#### 测试方法:

打开浏览器开发者工具（应用启动时会自动打开），在 Console 中运行:

```javascript
// 测试切换到上传中状态 (绿色图标)
window.electronAPI.updateTrayIcon('uploading')

// 测试切换到通知状态 (黄色图标)
window.electronAPI.updateTrayIcon('notification')

// 测试切换回正常状态 (蓝色图标)
window.electronAPI.updateTrayIcon('normal')
```

**预期结果**:
- `uploading` → 托盘图标变为**绿色**，提示文字变为"云图渲染客户端 - 上传中..."
- `notification` → 托盘图标变为**黄色**，提示文字变为"云图渲染客户端 - 有新通知"
- `normal` → 托盘图标变为**蓝色**，提示文字变为"云图渲染客户端"

### 6. 测试托盘角标 (任务计数)

在开发者工具 Console 中运行:

```javascript
// 设置未完成任务数为 5
window.electronAPI.updateTrayBadge(5)

// 清除角标
window.electronAPI.updateTrayBadge(0)
```

**预期结果**:
- macOS: Dock 图标上显示数字角标 "5"
- Windows: 托盘提示文字变为"云图渲染客户端 - 5 个未完成任务"

### 7. 测试窗口关闭行为

1. 点击窗口的关闭按钮 (或按 Cmd+W / Alt+F4)
2. **验证**: 窗口应该隐藏到托盘，而不是退出应用
3. 检查托盘图标是否仍然存在
4. 双击托盘图标或右键选择"显示主窗口"恢复

### 8. 测试退出程序

1. 右键点击托盘图标
2. 选择"退出程序"
3. **验证**: 应用完全退出，托盘图标消失

---

## 🔍 自动化测试 (集成到上传流程)

托盘图标状态会自动更新，无需手动调用 API:

1. **启动应用后**: 图标为蓝色 (normal)
2. **上传文件时**: 图标自动变为绿色 (uploading)
3. **上传完成后**:
   - 如果还有未完成任务: 图标变为黄色 (notification)
   - 如果所有任务完成: 图标变回蓝色 (normal)

这是通过 `src/composables/useTray.ts` 的 `setupTrayWatcher()` 函数实现的，每秒自动检查上传任务状态并更新图标。

---

## 📋 测试检查清单

在测试过程中，请验证以下功能:

### 托盘图标
- [ ] 启动时托盘图标正确显示 (蓝色圆角正方形)
- [ ] 图标清晰可见，没有模糊或失真
- [ ] macOS 上图标大小适配菜单栏
- [ ] 鼠标悬停时显示提示文字

### 托盘菜单
- [ ] 右键点击显示菜单
- [ ] 所有菜单项都能正确点击
- [ ] 分隔线正确显示
- [ ] "显示主窗口" 能恢复窗口
- [ ] "退出程序" 能完全退出应用

### 双击行为
- [ ] 双击托盘图标能恢复窗口
- [ ] 双击后窗口获得焦点

### 窗口关闭
- [ ] 关闭窗口后，窗口隐藏但应用不退出
- [ ] 托盘图标仍然保留
- [ ] 第一次关闭时可能显示提示气泡 (Windows)

### 图标状态切换
- [ ] 手动调用 API 能切换图标颜色
- [ ] 蓝色 (normal) 状态正确显示
- [ ] 绿色 (uploading) 状态正确显示
- [ ] 黄色 (notification) 状态正确显示
- [ ] 提示文字随状态更新

### 角标/计数
- [ ] macOS: Dock 角标显示数字
- [ ] Windows: 提示文字包含任务数
- [ ] 设置为 0 时角标消失

### 自动更新
- [ ] 上传文件时图标自动变绿
- [ ] 上传完成后图标自动变蓝或黄
- [ ] 每秒自动检查状态 (1000ms 定时器)

---

## 🐛 常见问题

### 问题 1: 托盘图标不显示

**可能原因**:
- 图标文件路径错误
- 图标文件未正确复制到 public/icons/

**解决方法**:
```bash
# 检查图标文件是否存在
ls -lh public/icons/tray-icon*.png

# 应该看到 6 个 PNG 文件
```

### 问题 2: 图标模糊或太大/太小

**可能原因**:
- 使用了错误的图标尺寸

**解决方法**:
- 确保使用 `@2x.png` (32x32) 版本用于托盘显示
- 256x256 版本仅用于预览

### 问题 3: macOS 上看不到图标

**可能原因**:
- 菜单栏空间不足，图标被隐藏

**解决方法**:
- 关闭一些菜单栏图标腾出空间
- 或者使用 Cmd+拖动 重新排列图标

### 问题 4: 图标不随状态变化

**可能原因**:
- useTray 定时器未启动
- App.vue 中未调用 setupTrayWatcher()

**解决方法**:
- 检查 `src/App.vue` 是否正确集成 useTray
- 查看控制台是否有错误日志

---

## 📸 截图建议

测试时建议截取以下画面:

1. 托盘图标显示 (蓝色状态)
2. 托盘右键菜单
3. 图标状态切换 (绿色/黄色)
4. macOS Dock 角标显示
5. 窗口关闭后托盘图标保留

---

## ✅ 测试完成标志

当以上所有检查项都通过时，托盘功能测试即为完成。

如果发现任何问题，请记录:
- 问题描述
- 复现步骤
- 预期行为 vs 实际行为
- 系统环境 (macOS/Windows, 版本号)

---

**祝测试顺利！** 🎉
